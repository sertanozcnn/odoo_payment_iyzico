<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- iyzico Provider Form View Extension -->
    <record id="payment_provider_form_iyzico" model="ir.ui.view">
        <field name="name">payment.provider.form.iyzico</field>
        <field name="model">payment.provider</field>
        <field name="inherit_id" ref="payment.payment_provider_form"/>
        <field name="arch" type="xml">
            <!-- Add iyzico_website_ids field after company_id -->
            <xpath expr="//field[@name='company_id']" position="after">
                <field name="iyzico_website_ids"
                       invisible="code != 'iyzico'"
                       widget="many2many_tags"
                       options="{'no_create': True, 'no_quick_create': True}"/>
            </xpath>
            
            <!-- Add Icon Update Button in header -->
            <xpath expr="//button[@name='action_toggle_is_published']" position="after">
                <button name="action_update_iyzico_icons"
                        type="object"
                        string="Görselleri Güncelle"
                        class="btn-secondary"
                        icon="fa-picture-o"
                        invisible="code != 'iyzico'"/>
            </xpath>

            <group name="provider_credentials" position="inside">
                <!-- iyzico Credentials Section -->
                <group string="iyzico Credentials" 
                       name="iyzico_credentials"
                       invisible="code != 'iyzico'">
                    <field name="iyzico_api_key"
                           password="True"
                           placeholder="Enter your iyzico API Key"/>
                    <field name="iyzico_secret_key"
                           password="True"
                           placeholder="Enter your iyzico Secret Key"/>
                    
                    <!-- Test Connection Button -->
                    <button name="action_iyzico_test_connection"
                            type="object"
                            string="Test Connection"
                            class="btn-primary oe_highlight"
                            icon="fa-plug"
                            invisible="code != 'iyzico'"/>
                    
                    <!-- API Verification Status -->
                    <field name="iyzico_api_verified"
                           widget="boolean_toggle"
                           readonly="1"/>
                    
                    <!-- Test Mode Indicator -->
                    <div invisible="state != 'test'" class="alert alert-warning" role="alert">
                        <strong>TEST MODU AKTİF / TEST MODE ACTIVE</strong>
                        <br/>
                        Sandbox API kullanılıyor. Gerçek ödemeler alınamaz.
                        <br/>
                        Using Sandbox API. Real payments will not be processed.
                        <br/>
                        <br/>
                        <strong>Test Kartları / Test Cards:</strong>
                        <br/>
                        • Halkbank: 5528790000000008
                        <br/>
                        • Denizbank: 4766620000000001
                        <br/>
                        • Expire: 12/30, CVV: 123
                    </div>
                    
                    <!-- Production Mode Indicator -->
                    <div invisible="state != 'enabled'" class="alert alert-success" role="alert">
                        <strong>CANLI MOD AKTİF / PRODUCTION MODE ACTIVE</strong>
                        <br/>
                        Production API kullanılıyor. Gerçek ödemeler işleniyor!
                        <br/>
                        Using Production API. Real payments are being processed!
                    </div>
                </group>
                
                <!-- iyzico Payment Options -->
                <group string="Payment Options" 
                       name="iyzico_payment_options"
                       invisible="code != 'iyzico'">
                    <field name="iyzico_enable_installments"/>
                    <field name="iyzico_max_installments" 
                           invisible="not iyzico_enable_installments"/>
                    <field name="iyzico_force_3ds"/>
                </group>
            </group>
        </field>
    </record>

    <!-- iyzico Provider Kanban View Icon -->
    <record id="payment_provider_kanban_iyzico" model="ir.ui.view">
        <field name="name">payment.provider.kanban.iyzico</field>
        <field name="model">payment.provider</field>
        <field name="inherit_id" ref="payment.payment_provider_kanban"/>
        <field name="arch" type="xml">
            <xpath expr="//kanban" position="inside">
                <field name="code"/>
                <field name="iyzico_website_ids"/>
            </xpath>
        </field>
    </record>
</odoo>
