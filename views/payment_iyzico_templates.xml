<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
    iyzico Redirect Form Template

    This template redirects the user directly to the iyzico payment page.
    The form uses GET method since iyzico expects token in URL parameters.
    -->

    <template id="redirect_form">
        <form t-att-action="api_url" method="get" id="iyzico_redirect_form">
            <t t-if="url_params">
                <t t-foreach="url_params" t-as="param_key">
                    <input type="hidden" t-att-name="param_key" t-att-value="url_params[param_key]"/>
                </t>
            </t>
        </form>

        <script type="text/javascript">
            // Auto-submit form for smooth redirect
            document.getElementById('iyzico_redirect_form').submit();
        </script>
    </template>

    <!-- Override the no payment methods warning to show dynamic helpful messages -->
    <template id="iyzico_no_pms_available_warning" inherit_id="payment.no_pms_available_warning" customize_show="True">
        <!-- Replace the non-admin message by finding the div with text content -->
        <xpath expr="//div[hasclass('alert', 'alert-warning')]/div[last()]" position="replace">
            <div t-if="request.env.is_system()" class="mt-2">
                <p t-if="providers_sudo">
                    Yapılandırılmış ödeme sağlayıcıları mevcut ancak aşağıdaki kriterlerle uyumlu değil:
                    <br/>
                    <strong>Konum:</strong> <t t-out="request.env.company.country_id.name or 'Belirtilmemiş'"/>
                    <br/>
                    <strong>Para Birimi:</strong> <t t-out="request.env.company.currency_id.name or 'Belirtilmemiş'"/>
                </p>
                <p t-else="">
                    Yapılandırılmış ödeme sağlayıcısı bulunmuyor.
                </p>
                <a
                    t-if="availability_report"
                    role="button"
                    class="btn-link alert-warning me-2"
                    data-bs-toggle="collapse"
                    href="#payment_availability_report"
                >
                    <strong><i class="fa fa-file-text"/> Uyumluluk Raporunu Göster</strong>
                </a>
                <a
                    t-if="not providers_sudo"
                    role="button"
                    type="action"
                    class="btn-link alert-warning me-2"
                    href="/odoo/action-payment.action_payment_provider"
                >
                    <strong><i class="oi oi-arrow-right"/> Ödeme Sağlayıcıları</strong>
                </a>
                <a
                    t-else=""
                    role="button"
                    type="action"
                    class="btn-link alert-warning"
                    href="/odoo/action-payment.action_payment_method"
                >
                    <strong><i class="oi oi-arrow-right"/> Ödeme Yöntemleri</strong>
                </a>
            </div>
            <!-- Show user-friendly message for non-admin users -->
            <div t-else="" class="mt-2">
                <p class="mb-0">
                    <strong>Olası nedenler:</strong>
                </p>
                <ul class="mb-0">
                    <li>Bulunduğunuz konum için uygun ödeme yöntemi yapılandırılmamış olabilir.</li>
                    <li>Seçtiğiniz para birimi desteklenmiyor olabilir.</li>
                    <li>Ödeme sağlayıcısı bakım modunda olabilir.</li>
                </ul>
                <p class="mb-0 mt-2">
                    Lütfen farklı bir ödeme yöntemi deneyin veya daha sonra tekrar deneyin.
                    <br/>
                    Sorun devam ederse lütfen müşteri hizmetleri ile iletişime geçin.
                </p>
            </div>
        </xpath>
        <!-- Update the title for all users -->
        <xpath expr="//div[hasclass('alert', 'alert-warning')]/div[1]/strong" position="replace">
            <strong>Ödeme yöntemi mevcut değil</strong>
        </xpath>
    </template>

</odoo>
